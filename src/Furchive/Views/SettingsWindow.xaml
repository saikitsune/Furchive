<Window x:Class="Furchive.Views.SettingsWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ui="http://schemas.modernwpf.com/2019"
    Title="Settings" Height="600" Width="720"
    ui:WindowHelper.UseModernWindowStyle="True"
    Background="{DynamicResource SystemControlBackgroundAltHighBrush}">
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
        <ui:ThemeResources />
        <ui:XamlControlsResources />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="16">
            <!-- Top actions -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,8">
                <Button Content="Save" Command="{Binding SaveCommand}" Margin="0,0,8,0"/>
                <Button Content="Close" Click="Close_Click"/>
            </StackPanel>
            <TextBlock Text="Appearance" FontWeight="Bold" Margin="0,0,0,8"/>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                <TextBlock Text="Theme:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                <ComboBox Width="160" SelectedIndex="0" SelectionChanged="Theme_SelectionChanged">
                    <ComboBoxItem Content="System"/>
                    <ComboBoxItem Content="Light"/>
                    <ComboBoxItem Content="Dark"/>
                </ComboBox>
            </StackPanel>

            <Separator/>
            <TextBlock Text="Downloads" FontWeight="Bold" Margin="0,12,0,8"/>
            <StackPanel>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,6">
                    <TextBlock Text="Default Folder:" VerticalAlignment="Center" Width="120"/>
                    <TextBox Text="{Binding DefaultDownloadDirectory, UpdateSourceTrigger=PropertyChanged}" Width="420"/>
                    <Button Content="Browse..." Margin="8,0,0,0" Click="BrowseDownloadFolder_Click"/>
                    <Button Content="Open" Margin="8,0,0,0" Click="OpenDownloadsFolder_Click"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Filename Template:" VerticalAlignment="Center" Width="120"/>
                    <TextBox Text="{Binding FilenameTemplate, UpdateSourceTrigger=PropertyChanged}" Width="420"/>
                </StackPanel>
                <TextBlock FontSize="10" Foreground="Gray" Text="Placeholders: {source}, {artist}, {id}, {safeTitle}, {ext}" Margin="120,2,0,0"/>
            </StackPanel>

            <Separator/>
            <TextBlock Text="Playback" FontWeight="Bold" Margin="0,12,0,8"/>
            <StackPanel>
                <CheckBox Content="Autoplay videos" IsChecked="{Binding VideoAutoplay}"/>
                <CheckBox Content="Start videos muted" IsChecked="{Binding VideoStartMuted}"/>
                <TextBlock FontSize="10" Foreground="Gray" TextWrapping="Wrap"
                           Text="Chromium may block autoplay with sound; enabling “Start video muted” ensures autoplay works reliably."/>
            </StackPanel>

            <Separator/>
            <TextBlock Text="Authentication" FontWeight="Bold" Margin="0,12,0,8"/>

            <GroupBox Header="e621" Margin="0,0,0,8">
                <StackPanel Margin="8">
                    <TextBlock Text="User-Agent (required)"/>
                    <TextBox Text="{Binding E621UserAgent, UpdateSourceTrigger=PropertyChanged}"/>
                    <TextBlock Text="Username (optional)" Margin="0,8,0,0"/>
                    <TextBox Text="{Binding E621Username, UpdateSourceTrigger=PropertyChanged}"/>
                    <TextBlock Text="API Key (optional)" Margin="0,8,0,0"/>
                    <TextBox Text="{Binding E621ApiKey, UpdateSourceTrigger=PropertyChanged}"/>
                    <Button Content="Test e621" Margin="0,8,0,0" Click="TestE621_Click"/>
                </StackPanel>
            </GroupBox>

            <!-- Other platforms removed; focusing on e621 only -->

            <Separator/>
            <TextBlock Text="Cache" FontWeight="Bold" Margin="0,8,0,8"/>
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock Text="Path:" Margin="0,0,8,0"/>
                <TextBlock Text="{Binding CachePath}"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,4,0,0">
                <TextBlock Text="Used:" Margin="0,0,8,0"/>
                <TextBlock Text="{Binding CacheUsedBytes, Converter={StaticResource BytesToStringConverter}}"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                <Button Content="Refresh" Command="{Binding RefreshCacheInfoCommand}" Margin="0,0,8,0"/>
                <Button Content="Clear Cache" Command="{Binding ClearCacheCommand}" Margin="0,0,8,0"/>
                <Button Content="Open Cache Folder" Click="OpenCacheFolder_Click"/>
            </StackPanel>

            <!-- Moved Temp (Viewer) section below Cache -->
            <Separator/>
            <TextBlock Text="Temp (Viewer)" FontWeight="Bold" Margin="0,12,0,8"/>
            <StackPanel>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Path:" Margin="0,0,8,0"/>
                    <TextBlock Text="{Binding TempPath}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,4,0,0">
                    <TextBlock Text="Used:" Margin="0,0,8,0"/>
                    <TextBlock Text="{Binding TempUsedBytes, Converter={StaticResource BytesToStringConverter}}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                    <Button Content="Refresh" Command="{Binding RefreshTempInfoCommand}" Margin="0,0,8,0"/>
                    <Button Content="Clear Temp" Command="{Binding ClearTempCommand}" Margin="0,0,8,0"/>
                    <Button Content="Open Temp Folder" Click="OpenTempFolder_Click"/>
                </StackPanel>
            </StackPanel>

            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0">
                <Button Content="Save" Command="{Binding SaveCommand}" Margin="0,0,8,0"/>
                <Button Content="Close" Click="Close_Click"/>
            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</Window>
