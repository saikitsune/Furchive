<Window xmlns="https://github.com/avaloniaui" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:beh="using:Furchive.Avalonia.Behaviors" x:Class="Furchive.Avalonia.Views.ViewerWindow" Width="1100" Height="800" MinWidth="600" MinHeight="400" Title="Viewer" Icon="avares://Furchive/Assets/icon.ico">
    <Window.Styles>
        <!-- Base style for video control buttons -->
        <Style Selector="Button.video-btn">
            <Setter Property="Background" Value="#3A3D42" />
            <Setter Property="Foreground" Value="#F0F0F0" />
            <Setter Property="BorderBrush" Value="#55595F" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="Padding" Value="10,4" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>
        <Style Selector="Button.video-btn:pointerover">
            <Setter Property="Background" Value="#484C52" />
        </Style>
        <Style Selector="Button.video-btn:pressed">
            <Setter Property="Background" Value="#303337" />
        </Style>
        <!-- Toggle button style (loop) -->
        <Style Selector="ToggleButton.video-btn">
            <Setter Property="Background" Value="#3A3D42" />
            <Setter Property="Foreground" Value="#F0F0F0" />
            <Setter Property="BorderBrush" Value="#55595F" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="Padding" Value="10,4" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>
        <Style Selector="ToggleButton.video-btn:checked">
            <Setter Property="Background" Value="#2C6A3F" />
            <Setter Property="BorderBrush" Value="#349857" />
        </Style>
        <Style Selector="ToggleButton.video-btn:pointerover:not(:checked)">
            <Setter Property="Background" Value="#484C52" />
        </Style>
        <Style Selector="Slider#SeekSlider">
            <Setter Property="Height" Value="20" />
        </Style>
        <!-- Thicker seek slider styling -->
        <Style Selector="Slider.seek-slider">
            <Setter Property="Height" Value="32" />
            <Setter Property="MinHeight" Value="32" />
        </Style>
        <Style Selector="Slider.seek-slider:horizontal /template/ Border#PART_TrackBackground">
            <Setter Property="Height" Value="10" />
            <Setter Property="CornerRadius" Value="5" />
        </Style>
        <Style Selector="Slider.seek-slider:horizontal /template/ Border#PART_TrackFill">
            <Setter Property="Height" Value="10" />
            <Setter Property="CornerRadius" Value="5" />
        </Style>
        <!-- Volume slider styling -->
        <Style Selector="Slider.volume-slider">
            <Setter Property="Height" Value="30" />
            <Setter Property="MinHeight" Value="30" />
        </Style>
        <Style Selector="Slider.volume-slider:horizontal /template/ Border#PART_TrackBackground">
            <Setter Property="Height" Value="8" />
            <Setter Property="CornerRadius" Value="4" />
        </Style>
        <Style Selector="Slider.volume-slider:horizontal /template/ Border#PART_TrackFill">
            <Setter Property="Height" Value="8" />
            <Setter Property="CornerRadius" Value="4" />
        </Style>
    </Window.Styles>
    <Grid RowDefinitions="Auto,Auto,*">
        <!-- Control bar -->
        <DockPanel Grid.Row="0" Background="#2b2b2b" Height="40" LastChildFill="False">
            <StackPanel Orientation="Horizontal" Spacing="8" Margin="10,0" VerticalAlignment="Center">
                <Button x:Name="ZoomButton" Content="Zoom" Click="OnZoomButtonClick" />
                <TextBlock Text="Size:" Margin="16,0,4,0" VerticalAlignment="Center" />
                <ComboBox x:Name="SizeModeCombo" Width="110" SelectedIndex="0" SelectionChanged="OnSizeModeSelectionChanged">
                    <ComboBoxItem Content="Fit" />
                    <ComboBoxItem Content="Original" />
                </ComboBox>
                <Button x:Name="PrevButton" Content="Prev" Margin="24,0,0,0" IsVisible="False" Click="OnPrevClick" />
                <Button x:Name="NextButton" Content="Next" IsVisible="False" Click="OnNextClick" />
                <TextBlock x:Name="IndexLabel" Text="" Margin="12,0,0,0" VerticalAlignment="Center" IsVisible="False" />
                <TextBlock x:Name="PoolNameLabel" Text="" Margin="24,0,0,0" VerticalAlignment="Center" IsVisible="False" />
            </StackPanel>
        </DockPanel>
        <!-- Zoom slider panel (collapsible) -->
        <Border x:Name="ZoomPanel" Grid.Row="1" Background="#333" Padding="10" IsVisible="False">
            <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                <TextBlock Text="Zoom:" VerticalAlignment="Center" />
                <Slider x:Name="ZoomSlider" Minimum="10" Maximum="1000" Value="100" Width="300" ValueChanged="OnZoomSliderChanged" />
                <TextBlock x:Name="ZoomPercent" Text="100%" VerticalAlignment="Center" />
            </StackPanel>
        </Border>
        <!-- Image viewport with wheel-based zoom anchoring -->
        <Border Grid.Row="2" Background="#202020" ClipToBounds="True">
            <!-- Plain host (no scrollbars). We handle zoom + translation manually. -->
            <Grid x:Name="ViewportHost" PointerWheelChanged="OnViewportWheel" PointerPressed="OnViewportPointerPressed" PointerReleased="OnViewportPointerReleased" PointerMoved="OnViewportPointerMoved" Background="#101010">
                <Image x:Name="ImageElement" Stretch="Uniform" beh:RemoteImage.SourceUri="" RenderTransformOrigin="0,0" HorizontalAlignment="Center" VerticalAlignment="Center" />
                <Grid x:Name="VideoHost" IsVisible="False" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Background="#101010" RowDefinitions="*,Auto">
                    <!-- Native/Rendered video surface goes in row 0 dynamically -->
                    <Grid x:Name="VideoSurfaceLayer" Grid.Row="0" />
                    <!-- Fixed bottom control bar -->
                    <Border Grid.Row="1" x:Name="VideoControlsBar" Background="#222" Padding="6" IsVisible="True">
                        <Grid ColumnDefinitions="Auto,Auto,*,Auto,Auto,Auto,Auto" RowDefinitions="Auto" VerticalAlignment="Center">
                            <Button x:Name="PlayPauseButton" Classes="video-btn" Width="48" Height="30" Click="OnPlayPauseClick">
                                <Image x:Name="PlayPauseIcon" Width="18" Height="18" Source="{DynamicResource Icon.Play}" />
                            </Button>
                            <ToggleButton x:Name="LoopToggle" Classes="video-btn" Grid.Column="1" Width="48" Height="30" Margin="6,0,0,0" IsChecked="True" Checked="OnLoopToggleChanged" Unchecked="OnLoopToggleChanged">
                                <Image x:Name="LoopIcon" Width="18" Height="18" Source="{DynamicResource Icon.LoopOn}" />
                            </ToggleButton>
                            <StackPanel Grid.Column="2" Orientation="Vertical" Margin="12,0,12,0" VerticalAlignment="Center">
                                <Slider x:Name="SeekSlider" Classes="seek-slider" Minimum="0" Maximum="1000" Height="32" ValueChanged="OnSeekSliderValueChanged" PointerPressed="OnSeekSliderPointerPressed" PointerReleased="OnSeekSliderPointerReleased" />
                                <TextBlock x:Name="TimeLabel" Text="00:00 / 00:00" FontSize="11" Foreground="LightGray" HorizontalAlignment="Left" Margin="2,2,0,0" />
                            </StackPanel>
                            <Button x:Name="VolumeButton" Classes="video-btn" Grid.Column="3" Width="48" Height="30" Click="OnMuteClick">
                                <Image x:Name="VolumeIcon" Width="18" Height="18" Source="{DynamicResource Icon.Volume}" />
                            </Button>
                            <Slider x:Name="VolumeSlider" Classes="volume-slider" Grid.Column="4" Minimum="0" Maximum="100" Width="140" Height="30" ValueChanged="OnVolumeSliderValueChanged" />
                            <ComboBox x:Name="SpeedCombo" Grid.Column="5" Width="80" Height="30" SelectionChanged="OnSpeedSelectionChanged">
                                <ComboBoxItem Content="0.5x" />
                                <ComboBoxItem Content="1.0x" IsSelected="True" />
                                <ComboBoxItem Content="1.5x" />
                                <ComboBoxItem Content="2.0x" />
                            </ComboBox>
                            <Button x:Name="FullscreenButton" Classes="video-btn" Grid.Column="6" Width="48" Height="30" Margin="8,0,0,0" Click="OnFullscreenClick">
                                <Image x:Name="FullscreenIcon" Width="18" Height="18" Source="{DynamicResource Icon.Fullscreen}" />
                            </Button>
                        </Grid>
                    </Border>
                </Grid>
                <!-- Debug overlay rectangle (toggle IsVisible in code if needed) -->
                <Border x:Name="ViewportDebugBorder" BorderBrush="#55FF0000" BorderThickness="1" IsHitTestVisible="False" IsVisible="False" />
            </Grid>
        </Border>
    </Grid>
</Window>
