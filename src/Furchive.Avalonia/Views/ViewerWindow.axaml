<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:cvt="using:Furchive.Avalonia.Converters"
    x:Class="Furchive.Avalonia.Views.ViewerWindow"
    x:Name="Root"
        Width="1000" Height="800" Title="Viewer">
    <Window.Resources>
    <cvt:FileTypeIsPlayableConverter x:Key="FileTypeIsPlayable"/>
        <cvt:ImageCacheConverter x:Key="ImageCache"/>
    </Window.Resources>
    <Grid RowDefinitions="Auto,*,Auto" ColumnDefinitions="*">
        <StackPanel Orientation="Horizontal" Margin="8" Spacing="8">
            <TextBlock Text="Viewer" FontSize="18"/>
            <TextBlock Text="·"/>
            <TextBlock Text="{Binding Title}"/>
            <TextBlock Text="·"/>
            <TextBlock Text="{Binding Artist}"/>
        </StackPanel>

        <!-- Image rendering; if video type, show a placeholder with actions -->
        <Grid Grid.Row="1" Margin="8">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid>
                <!-- Image mode -->
                <Border Background="#202020" IsVisible="{Binding FileExtension, Converter={StaticResource FileTypeIsPlayable}, ConverterParameter=False}">
                    <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                        <Image Stretch="Uniform" Source="{Binding FullImageUrl, Converter={StaticResource ImageCache}}"/>
                    </ScrollViewer>
                </Border>
                <!-- Video mode fallback: show a link to open in browser -->
                <Border Background="#000000" IsVisible="{Binding FileExtension, Converter={StaticResource FileTypeIsPlayable}}">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="8">
                        <TextBlock Foreground="White" Text="Video content"/>
                        <Button Content="Open in browser" Click="OnOpenOriginal"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>

        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="8" Spacing="8">
            <Button Content="Close" Click="OnClose"/>
        </StackPanel>
    </Grid>
</Window>
